[[extend 'layout.html']]

<style>
  [v-cloak] { display: none; }

  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
</style>


<div class="section" id="app" v-cloak>
  <!-- Left Column (3/4 width): Post Creation and Feed -->
  <div class="left-column" style="width: 75%; float: left; padding-right: 1rem;">
    <!-- Post Creation Area -->
    <textarea class="textarea" id="post-input" v-model="newPostContent" placeholder="Write something..."></textarea>
    <button id="post-button" class="button is-success mt-2" @click="createPost">Post</button>

    <!-- Post Feed -->
    <h2>Posts</h2>
    <div v-for="post in filteredPosts" :key="post.id" class="post box mb-4" style="position: relative; padding-bottom: 2rem;">
      <p class="post-content">{{ post.content }}</p>

      <div class="has-text-grey">
        <p>Posted on {{ post.created_on }} by user {{ post.user_email }}</p>
      </div>
      
      <div v-if="post.user_email === currentUser" style="position: absolute; bottom: 1rem; right: 1rem;">
        <button 
          @click="deletePost(post.id)"
          class="button is-danger is-small delete-button">
          <span class="icon"><i class="fa fa-trash"></i></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Right Column (1/4 width): Tags -->
  <div class="right-column" style="width: 25%; float: left;">
    <h1 class="mb-4 has-text-weight-bold">Tags</h1>
    <div class="tags">
      <div class="columns is-multiline is-gapless">
        <div class="column is-6" v-for="tag in tags" :key="tag.id">
          <button
            :class="{
              'button': true,
              'is-success': activeTags.includes(tag.name),
              'is-light': !activeTags.includes(tag.name)
            }"
            @click="toggleTag(tag.name)"
            class="mr-1 mb-2 is-rounded is-focused">
            {{ tag.name }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


[[block page_scripts]]
<script>
  let get_posts_url = "[[=XML(get_posts_url)]]";
  let create_post_url = "[[=XML(create_post_url)]]";
  let delete_post_url = "[[=XML(delete_post_url)]]";
  let current_user_email = "[[=XML(current_user_email)]]";
</script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js"></script>
<script src="[[=URL('static/js/index.js')]]"></script>
[[end]]